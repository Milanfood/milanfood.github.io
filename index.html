<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Milan Food ‚Äî Raspa & Gana</title>
<meta name="description" content="Raspa, sorpr√©ndete y genera tu cup√≥n √∫nico con nombre y tel√©fono.">
<style>
  :root{{
    --bg:#0f1116; --card:#171a22; --fg:#f6f7fb; --muted:#aab1c6;
    --accent:#ff4d4f; --accent2:#ffb347; --ok:#31d095; --surprise:#00e0a4;
  }}
  *{{box-sizing:border-box}}
  html,body{{height:100%}}
  body{{
    margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    color:var(--fg); background: radial-gradient(1200px 800px at 70% 10%, #1b2130 0%, var(--bg) 55%), var(--bg);
    display:grid; place-items:center; padding:24px;
  }}
  .wrap{{width:100%; max-width:980px; display:grid; gap:16px}}
  header{{display:grid; gap:10px; text-align:center}}
  .brand img{{height:80px; width:auto; object-fit:contain; filter: drop-shadow(0 6px 16px rgba(0,0,0,.35));}}
  h1{{margin:0; font-size:clamp(20px,3.2vw,30px); font-weight:800; letter-spacing:.2px}}
  .sub{{margin:0; color:var(--muted)}}
  .zone{{ display:grid; gap:14px; grid-template-columns: 1fr 1fr; }}
  @media (max-width:900px){{ .zone{{grid-template-columns:1fr}} }}
  .card{{
    background:linear-gradient(180deg,#1b1f29,var(--card));
    border:1px solid #232838; border-radius:18px; padding:18px;
    box-shadow: 0 10px 26px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.03);
  }}
  .title{{font-weight:800; margin:0 0 8px 0}}
  .scratch-wrap{{position:relative; aspect-ratio: 16/10; border-radius:14px; overflow:hidden; background:#0d0f14; isolation:isolate;}}
  .prize{{
    position:absolute; inset:0; display:grid; place-items:center; padding:16px; text-align:center;
    background:
      radial-gradient(90% 90% at 50% 10%, rgba(255,255,255,.05), rgba(0,0,0,0) 60%),
      linear-gradient(135deg, rgba(255,77,79,.08), rgba(255,179,71,.08));
  }}
  .prize h2{{margin:.1em 0; font-size:clamp(22px,5.4vw,42px)}}
  .prize .badge{{display:inline-block; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.08); border:1px solid #2b3040; font-size:12px; color:#cfd5ea}}
  .overlay{{ position:absolute; inset:0; background:#b5b9c8; }}
  canvas#scratch{{position:absolute; inset:0; width:100%; height:100%; touch-action:none; cursor:grab}}
  .hint{{font-size:13px; color:#cfd5ea; opacity:.85}}
  .ok{{color:var(--ok); font-weight:700}}

  .surprise{{display:none; place-items:center; gap:8px; text-align:center; padding:14px; border-radius:14px;
            background:linear-gradient(90deg,#00e0a4,#ffb347); color:#121314; font-weight:900;
            transform: translateY(10px) scale(0.96); opacity:0;}}
  .surprise.show{{display:grid; animation: pop 700ms cubic-bezier(.2,.9,.2,1) forwards; }}
  @keyframes pop{{ to{{ transform:translateY(0) scale(1); opacity:1; }} }}
  .confetti{{position:absolute; inset:0; pointer-events:none}}

  .inputs{{display:grid; gap:10px; opacity:.5; filter:grayscale(1)}}
  .inputs.enabled{{opacity:1; filter:none}}
  label{{font-size:13px; color:#cfd5ea}}
  input{{
    width:100%; padding:12px 14px; border-radius:12px; border:1px solid #2a3042;
    background:#12151d; color:#f6f7fb; outline:none;
  }}
  .row{{display:grid; gap:10px; grid-template-columns:1fr 1fr}}
  @media (max-width:520px){{ .row{{grid-template-columns:1fr}} }}
  .btn{{
    appearance:none; border:none; border-radius:14px; padding:14px 16px; font-weight:800;
    background:linear-gradient(90deg,#ff4d4f,#ffb347); color:#1a1a1a; cursor:pointer;
    box-shadow:0 12px 28px rgba(255,77,79,.22);
  }}
  .btn:disabled{{filter:grayscale(1); opacity:.6; cursor:not-allowed}}
  .lite{{background:#23283a; color:#e7ebff; box-shadow:none}}
  .stack{{display:grid; gap:12px}}
  .terms{{font-size:12px; color:#cfd5ea}}
  .footer{{opacity:.7; font-size:12px; text-align:center; margin-top:8px}}
  .whats{{
    justify-self:center; text-decoration:none; margin-top:4px;
    display:inline-flex; gap:10px; align-items:center; padding:12px 14px; border-radius:14px;
    background:linear-gradient(90deg,#ff4d4f,#ffb347); color:#1a1a1a; font-weight:800;
  }}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand"><img src="assets/logo.png" alt="Milan Food logo"></div>
      <h1>Raspa, sorpr√©ndete y canjea tu cup√≥n üéâ</h1>
      <p class="sub">Primero raspa. Cuando termines, te mostraremos la sorpresa y podr√°s generar tu cup√≥n √∫nico.</p>
    </header>

    <div class="zone">
      <section class="card stack">
        <h3 class="title">üéÅ Raspa y gana</h3>
        <div class="scratch-wrap">
          <div class="prize" id="prize">
            <div>
              <span class="badge">Premio oculto</span>
              <h2>Raspa para revelar</h2>
              <p class="hint">Desliza el dedo o el mouse sobre la tarjeta.</p>
            </div>
          </div>
          <div class="overlay"></div>
          <canvas id="scratch"></canvas>
          <canvas id="confetti" class="confetti"></canvas>
        </div>
        <div id="surprise" class="surprise">üéâ ¬°GANASTE $1.000 DE DESCUENTO! üéâ</div>
        <p id="status" class="hint">Progreso: <b>0%</b> ‚Äî Completa el <b>85%</b> para desbloquear.</p>
        <a id="waBtn" class="whats" href="#" target="_blank" rel="noopener" style="display:none">Enviar por WhatsApp</a>
      </section>

      <section class="card">
        <h3 class="title">üßæ Generar cup√≥n</h3>
        <div id="form" class="inputs">
          <div class="row">
            <div>
              <label for="nombre">Nombre y Apellido</label>
              <input id="nombre" placeholder="Ej: Juan P√©rez" autocomplete="name" disabled>
            </div>
            <div>
              <label for="telefono">Tel√©fono</label>
              <input id="telefono" placeholder="+56 9 1234 5678" inputmode="tel" autocomplete="tel" disabled>
            </div>
          </div>
          <button id="gen" class="btn" disabled>Descargar cup√≥n ($1.000)</button>
          <button id="test" class="btn lite" disabled>Vista previa</button>
          <p class="terms">
            Condiciones: no es canjeable por dinero, no es transferible, v√°lido solo presentando el cup√≥n en el local junto a tu nombre y tel√©fono, 
            un cup√≥n por persona, no acumulable con otras promos, <b>promoci√≥n v√°lida hasta agotar stock</b>, validez 30 d√≠as desde su emisi√≥n.
          </p>
          <p class="hint">Para canjear en caja, env√≠a tu cup√≥n por WhatsApp y luego pres√©ntalo en el local.</p>
        </div>
      </section>
    </div>

    <div class="footer">¬© <span id="y"></span> Milan Food ¬∑ Hecho con ‚ô•</div>
  </div>

<script>
  document.getElementById('y').textContent = new Date().getFullYear();

  const canvas = document.getElementById('scratch');
  const ctx = canvas.getContext('2d');
  let isDown = false, revealed = false;

  function resizeCanvas(){{
    const r = canvas.getBoundingClientRect();
    canvas.width = Math.floor(r.width * devicePixelRatio);
    canvas.height = Math.floor(r.height * devicePixelRatio);
    ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    paintCover();
  }}
  function paintCover(){{
    const r = canvas.getBoundingClientRect();
    const grd = ctx.createLinearGradient(0,0,r.width,r.height);
    grd.addColorStop(0,'#bfc4d6'); grd.addColorStop(1,'#9aa0b4');
    ctx.globalCompositeOperation = 'source-over';
    ctx.fillStyle = grd;
    ctx.fillRect(0,0,r.width,r.height);
    ctx.fillStyle = 'rgba(0,0,0,.25)';
    ctx.font = '700 22px system-ui, Segoe UI, Roboto';
    ctx.textAlign='center';
    ctx.fillText('RASPA AQU√ç', r.width/2, r.height/2);
    ctx.strokeStyle='rgba(255,255,255,.35)';
    ctx.lineWidth=2;
    ctx.strokeRect(10,10,r.width-20,r.height-20);
  }}
  function scratch(x,y){{
    ctx.globalCompositeOperation = 'destination-out';
    ctx.beginPath();
    ctx.arc(x, y, 26, 0, Math.PI*2);
    ctx.fill();
  }}
  function percentCleared(samples=32){{
    const r = canvas.getBoundingClientRect();
    const data = ctx.getImageData(0,0,r.width,r.height).data;
    let cleared = 0, total = data.length/4;
    for(let i=0;i<total;i+=samples){{ if(data[i*4+3] === 0) cleared++; }}
    return (cleared/(total/samples))*100;
  }}

  function enableForm(){{
    const form = document.getElementById('form');
    form.classList.add('enabled');
    ['nombre','telefono'].forEach(id=>document.getElementById(id).disabled=false);
    document.getElementById('gen').disabled=false;
    document.getElementById('test').disabled=false;
  }}

  function showSurprise(){{
    const s = document.getElementById('surprise');
    s.classList.add('show');
    confettiBurst();
  }}

  function checkReveal(){{
    if(revealed) return;
    const pct = percentCleared(40);
    document.getElementById('status').innerHTML = `Progreso: <b>${{pct.toFixed(0)}}%</b> ‚Äî Completa el <b>85%</b> para desbloquear.`;
    if(pct>=85){{ revealed = true; showSurprise(); enableForm(); }}
  }}

  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();
  const pos = (e)=>{{
    const r = canvas.getBoundingClientRect();
    if(e.touches && e.touches[0]) return {{x: e.touches[0].clientX - r.left, y: e.touches[0].clientY - r.top}};
    return {{x: e.clientX - r.left, y: e.clientY - r.top}};
  }}
  const start = (e)=>{{ isDown=true; canvas.style.cursor='grabbing'; const p=pos(e); scratch(p.x,p.y); checkReveal(); }}
  const move  = (e)=>{{ if(!isDown) return; const p=pos(e); scratch(p.x,p.y); checkReveal(); }}
  const stop  = ()=>{{ isDown=false; canvas.style.cursor='grab'; }}
  canvas.addEventListener('mousedown', start);
  canvas.addEventListener('mousemove', move);
  window.addEventListener('mouseup', stop);
  canvas.addEventListener('touchstart', (e)=>{{ e.preventDefault(); start(e); }}, {{passive:false}});
  canvas.addEventListener('touchmove', (e)=>{{ e.preventDefault(); move(e); }}, {{passive:false}});
  canvas.addEventListener('touchend', (e)=>{{ e.preventDefault(); stop(e); }}, {{passive:false}});

  const cfx = document.getElementById('confetti');
  const g = cfx.getContext('2d');
  function confettiBurst(){{
    const rect = cfx.getBoundingClientRect();
    cfx.width = rect.width * devicePixelRatio;
    cfx.height= rect.height* devicePixelRatio;
    const P = [];
    for(let i=0;i<150;i++){{ P.push({{x:Math.random()*cfx.width,y:-Math.random()*100, vx:(Math.random()-0.5)*2, vy:Math.random()*3+2, s:Math.random()*6+3, a:Math.random()*Math.PI}}); }}
    let t=0;
    const colors=['#ff4d4f','#ffb347','#00e0a4','#58a6ff','#f8d847'];
    function step(){{
      g.clearRect(0,0,cfx.width,cfx.height);
      P.forEach((p,i)=>{{ p.x+=p.vx; p.y+=p.vy; p.a+=0.1; g.save(); g.translate(p.x,p.y); g.rotate(p.a); g.fillStyle=colors[i%colors.length]; g.fillRect(-p.s/2,-p.s/2,p.s,p.s); g.restore(); }});
      t++; if(t<180) requestAnimationFrame(step);
    }} step();
  }}

  function drawCoupon(name, phone, forPreview=false){{
    const W=1080,H=1350, pad=60;
    const c=document.createElement('canvas'); c.width=W; c.height=H;
    const g=c.getContext('2d');

    const bg=g.createLinearGradient(0,0,W,H);
    bg.addColorStop(0,'#181c27'); bg.addColorStop(1,'#10131b'); g.fillStyle=bg; g.fillRect(0,0,W,H);

    const wm = new Image(); wm.src='assets/logo.png';
    wm.onload = ()=>{{ 
      const scale = Math.min(800/wm.width, 0.9);
      const ww = Math.floor(wm.width*scale), hh = Math.floor(wm.height*scale);
      g.globalAlpha = 0.07; g.drawImage(wm, (W-ww)/2, (H-hh)/2, ww, hh); g.globalAlpha=1;
      renderForeground();
    }};
    wm.onerror = renderForeground;

    function renderForeground(){{
      g.strokeStyle='#ffb347'; g.lineWidth=6; g.strokeRect(18,18,W-36,H-36);

      const logo = new Image(); logo.src='assets/logo.png';
      logo.onload = ()=>{{ 
        const maxW = 460; const ratio = Math.min(maxW/logo.width, 1);
        const w = Math.floor(logo.width*ratio), h = Math.floor(logo.height*ratio);
        g.drawImage(logo, (W-w)/2, 34, w, h);

        g.fillStyle='#ffffff'; g.textAlign='center';
        g.font='800 50px system-ui, Segoe UI, Roboto'; g.fillText('CUP√ìN DE DESCUENTO', W/2, h+120);
        const grd=g.createLinearGradient(pad,0,W-pad,0); grd.addColorStop(0,'#ff4d4f'); grd.addColorStop(1,'#ffb347');
        g.fillStyle=grd; g.font='900 120px system-ui, Segoe UI, Roboto'; g.fillText('$1.000', W/2, h+240);
        g.font='700 40px system-ui, Segoe UI, Roboto'; g.fillText('EN PRIMERA COMPRA PRESENCIAL', W/2, h+300);

        g.fillStyle='#e9ecfa'; g.textAlign='left';
        g.font='700 38px system-ui, Segoe UI, Roboto'; g.fillText('Nombre:', pad, h+380);
        g.font='500 42px system-ui, Segoe UI, Roboto'; g.fillText(name||'‚Äî', pad+200, h+380);
        g.font='700 38px system-ui, Segoe UI, Roboto'; g.fillText('Tel√©fono:', pad, h+440);
        g.font='500 42px system-ui, Segoe UI, Roboto'; g.fillText(phone||'‚Äî', pad+200, h+440);

        const now = new Date();
        const fecha = now.toLocaleString('es-CL', {{ hour12:false }});
        const code='MF-' + now.toISOString().replace(/[-:TZ.]/g,'').slice(0,12);
        g.textAlign='left'; g.font='700 34px system-ui, Segoe UI, Roboto'; g.fillStyle='#cfd5ea';
        g.fillText('Fecha y hora:', pad, h+500);
        g.font='700 36px system-ui, Segoe UI, Roboto'; g.fillStyle='#ffffff'; g.fillText(fecha, pad+220, h+500);
        g.textAlign='left'; g.font='700 34px system-ui, Segoe UI, Roboto'; g.fillStyle='#cfd5ea'; g.fillText('C√≥digo:', pad, h+560);
        g.font='700 36px system-ui, Segoe UI, Roboto'; g.fillStyle='#ffffff'; g.fillText(code, pad+130, h+560);

        g.strokeStyle='rgba(255,255,255,.18)'; g.lineWidth=2; g.beginPath(); g.moveTo(pad, h+610); g.lineTo(W-pad, h+610); g.stroke();

        g.fillStyle='#cfd5ea'; g.textAlign='left'; g.font='600 32px system-ui, Segoe UI, Roboto';
        const terms=[
          '‚Ä¢ No es canjeable por dinero ni transferible.',
          '‚Ä¢ V√°lido presentando el cup√≥n en el local junto a nombre y tel√©fono.',
          '‚Ä¢ Un cup√≥n por persona. No acumulable con otras promos.',
          '‚Ä¢ Promoci√≥n v√°lida hasta agotar stock.',
          '‚Ä¢ Validez: 30 d√≠as desde su emisi√≥n.'
        ];
        let yy=h+660; terms.forEach(t=>{{ g.fillText(t, pad, yy); yy+=44; }});

        g.textAlign='center'; g.fillStyle='#97a3c2'; g.font='700 30px system-ui, Segoe UI, Roboto';
        g.fillText('¬© '+(new Date().getFullYear())+' Milan Food ‚Äî Presentar este cup√≥n en caja', W/2, H-40);
      }};
    }}

    return c;
  }}

  const btnGen = document.getElementById('gen');
  const btnPrev= document.getElementById('test');
  const waBtn = document.getElementById('waBtn');

  btnGen.addEventListener('click', ()=>{
    const name = document.getElementById('nombre').value.trim();
    const phone= document.getElementById('telefono').value.trim();
    if(!name || !phone){ alert('Completa nombre y tel√©fono para generar el cup√≥n.'); return; }
    const can = drawCoupon(name, phone);
    setTimeout(()=>{
      const link = document.createElement('a');
      link.download = `Cupon_MilanFood_${{Date.now()}}.png`;
      link.href = can.toDataURL('image/png');
      link.click();

      const code = 'MF-' + new Date().toISOString().replace(/[-:TZ.]/g,'').slice(0,12);
      const txt = encodeURIComponent(`Hola, quiero canjear mi cupon de descuento (${code}) para dejar agendado mi n√∫mero. Adjunto imagen del cup√≥n.`);
      waBtn.href = "https://wa.me/PHONE?text=TEXT".replace("PHONE","56937679969").replace("TEXT",txt);
      waBtn.style.display='inline-flex';
    }, 700);
  });

  btnPrev.addEventListener('click', ()=>{
    const name = document.getElementById('nombre').value.trim() || 'Nombre Apellido';
    const phone= document.getElementById('telefono').value.trim() || '+56 9 1234 5678';
    drawCoupon(name, phone, true);
  });
</script>
</body>
</html>
